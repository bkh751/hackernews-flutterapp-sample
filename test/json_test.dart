import 'dart:convert';

import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'package:untitled/json_parse.dart';

void main() {
  test("parse list int", () {
    const jsonString =
        """[28366063,28365163,28368626,28369654,28368622,28369165,28365928,28368630,28369069,28367177,28365880,28366113,28368701,28353997,28366794,28366395,28367101,28354303,28367090,28368435,28364923,28345119,28354637,28365138,28367524,28351877,28365925,28364756,28367553,28367598,28366351,28365948,28363758,28364530,28355302,28364629,28365645,28365437,28366305,28366477,28335315,28353464,28368953,28367440,28366945,28366644,28363313,28345821,28364032,28368997,28358463,28366124,28367030,28353826,28364511,28367406,28361320,28353399,28360139,28362172,28365818,28363453,28359625,28364403,28364140,28362199,28353010,28364279,28368303,28363813,28361600,28355622,28365459,28360069,28356638,28358405,28358828,28360087,28357462,28352674,28345609,28353372,28345868,28363676,28356141,28361098,28345620,28347439,28355273,28359998,28360072,28354194,28369361,28365185,28359639,28365135,28360509,28352397,28355497,28345810,28358391,28360515,28359911,28353157,28360030,28359853,28361102,28358751,28351432,28363479,28348996,28351721,28365669,28365763,28353876,28369425,28357065,28337268,28364281,28345422,28363482,28328250,28355312,28359157,28361341,28356100,28354564,28354769,28362930,28358489,28365471,28353289,28345567,28353358,28352075,28344792,28350466,28362320,28350679,28355754,28352380,28353016,28336850,28344384,28346873,28337112,28362990,28362404,28351951,28363310,28353065,28345617,28332205,28346044,28349201,28352168,28355115,28348696,28355502,28328158,28352617,28344938,28353051,28360437,28354021,28344110,28360081,28350412,28343941,28365526,28349738,28349475,28352892,28354442,28336123,28349068,28344885,28361371,28336836,28349246,28350279,28352358,28348135,28351923,28360920,28368391,28342504,28356781,28336891,28352300,28348524,28352454,28348693,28360987,28346358,28362488,28352616,28356136,28344744,28333152,28351420,28365680,28362497,28361730,28349696,28364087,28351687,28347298,28330031,28344635,28356447,28343930,28366708,28346349,28355035,28344319,28358724,28362752,28347089,28352943,28361266,28348110,28336024,28351399,28350812,28355633,28346826,28336109,28345673,28348844,28362765,28348445,28355242,28360624,28343073,28362672,28354096,28350142,28347141,28368224,28360236,28360220,28363899,28344386,28354641,28354617,28345704,28340272,28351618,28345565,28344339,28344952,28327660,28348318,28344561,28359550,28342809,28346418,28366016,28349107,28353095,28353789,28337196,28331504,28351659,28356125,28338677,28359842,28363874,28361807,28340330,28363370,28351999,28363129,28335775,28361627,28349925,28347321,28343109,28329444,28362968,28344302,28357620,28343867,28349463,28349328,28341201,28345487,28352704,28327694,28342527,28355964,28354306,28357718,28359651,28357628,28353681,28353599,28337836,28352568,28357417,28352178,28359518,28359507,28363254,28336815,28336036,28359321,28364033,28345362,28363043,28350312,28360461,28339983,28336105,28354799,28347293,28337435,28344677,28331345,28350919,28350228,28362632,28348277,28352127,28355685,28348133,28353894,28360988,28345589,28347792,28362293,28329286,28360808,28329672,28336192,28337271,28346158,28343661,28363289,28357301,28352642,28349564,28329409,28338937,28341717,28348883,28336724,28340417,28350215,28351267,28327661,28326685,28353261,28361428,28360400,28336077,28344421,28339735,28359243,28344862,28332962,28350456,28354137,28348621,28350185,28355360,28359709,28342478,28328730,28353993,28362650,28346191,28328657,28349455,28329211,28359123,28352295,28352487,28354828,28327022,28326806,28354718,28336498,28330828,28333061,28340717,28345754,28348719,28360038,28353420,28345952,28359920,28348402,28355418,28361969,28351352,28337064,28351631,28337905,28356381,28359376,28340542,28337426,28326932,28336913,28336293,28330122,28333274,28333608,28341737,28355971,28350711,28356574,28353676,28346427,28335085,28353515,28332480,28339991,28333326,28353444,28349971,28337793,28342374,28339545,28334261,28328724,28342151,28331610,28356887,28329878,28353814,28340101,28336742,28338749,28344400,28348806,28348575,28352956,28343989,28334566,28346578,28362216,28348224,28331686,28360432,28346450,28356116,28351423,28327029,28365326,28366215,28335786,28347116,28345829,28347516,28346416,28346904,28329906,28329547,28358822,28350563,28336048,28329507,28352993,28345799,28345430,28337819,28351136,28338830,28341324,28343334,28345169,28345973,28338634,28359100,28349680,28357702,28357534,28354545,28336006,28340278,28347454,28357143,28353232,28330062,28363010,28349784,28346802,28353071,28362958,28341313,28345820,28361918,28332004,28327111,28331760,28349456,28338498]""";
    expect(parseTopStories(jsonString).first, 28366063);
  });

  test("parse item.json", () {
    const jsonString =
        """{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8958,8884,8887,8869,8940,8908,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}""";
    expect(parseArticle(jsonString)!.by, "dhouston");
  });

  test("parse over http items.json", () async {
    var url = Uri.https('hacker-news.firebaseio.com', '/v0/topstories.json');
    final res = await http.get(url);
    if (res.statusCode == 200) {
      final idList = json.decode(res.body);
      if (idList.isNotEmpty) {
        final storyUrl = Uri.https(
            'hacker-news.firebaseio.com', '/v0/item/${idList.first}.json');
        final storyRes = await http.get(storyUrl);

        if (storyRes.statusCode == 200) {
          expect(parseArticle(storyRes.body)!.by, "nycdatasci");
        }
      }
    }
  });
}
